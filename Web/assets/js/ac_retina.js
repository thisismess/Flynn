AC.Retina=AC.Class();AC.Retina.prototype={__defaultOptions:{filenameRegex:/(.*)(\.[a-z]{3}($|#.*|\?.*))/i,filenameInsert:"_☃x",ignoreCheck:/(^http:\/\/movies\.apple\.com\/|\/105\/|\/global(\/ac_media_player)?\/elements\/quicktime\/|_(([2-9]|[1-9][0-9]+)x|nohires)(\.[a-z]{3})($|#.*|\?.*))/i,attribute:"data-hires",recursive:true,preload:false,checkExists:true,checkAsRootRelative:true,queueSize:8,disableOniOSHandheld:true,debug:false,lowestPriority:2,replacedAttribute:"data-hires-status"},initialize:function ac_initialize(c){if(typeof c!=="object"){c={}}this.options=AC.Object.extend(AC.Object.clone(this.__defaultOptions),c);if((this.options.debug!==true)&&!this.shouldReplace()){this.replace=AC.Function.emptyFunction;return false}if(this.options.debug===true){AC.Retina._devicePixelRatio=2}this._replacedElements=[];AC.Object.synthesize(this);if(AC.windowHasLoaded){this.__setup()}else{var d=this.__setup.bind(this);AC.Element.addEventListener(window,"load",d)}},shouldReplace:function ac_shouldReplace(){return !((AC.Retina.iOSHandheld()&&this.options.disableOniOSHandheld===true)||(AC.Retina.devicePixelRatio()<=1))},__setup:function ac___setup(){this.replace(document.body)},__addToQueue:function ac___addToQueue(b){if(typeof this.__queues==="undefined"){this.__queues=[]}if(this.__queues.length===0){this.__queues.push([])}this.__queues[this.__queues.length-1].push(b)},__potentialElements:function ac___potentialElements(j,k){if(typeof j==="undefined"){j=document.body}else{j=AC.Element.getElementById(j)}var h=AC.Array.toArray(j.querySelectorAll("["+this.options.attribute+"]"));var i;var n=function(a){if(typeof k==="undefined"){return !!AC.Retina.__nearestAncestorHasAttribute(j,a)}else{return k.getAttribute(a)!==null||typeof k.up("["+a+"]")!=="undefined"}};if(this.options.recursive===true){if(j!==document.body&&n(this.options.attribute)){h=h.concat(j)}i=[];var l=this.__isReplaceable.bind(this);var m=function(a){if(l(a)){i.push(a)}i=i.concat(this.__replaceableElementsWithinElement(a))}.bind(this);h.forEach(m)}else{i=h}return i},__isReplaceable:function ac___isReplaceable(f){if((f.getAttribute(this.options.attribute)==="false")||(!!AC.Retina.__nearestAncestorHasAttribute(f,this.options.attribute,"false")&&this.options.recursive===true)){return false}var e=(typeof f.responsiveImageObject==="undefined");if(f.tagName.toLowerCase()==="img"){return e}else{if(AC.Element.hasClassName(f,"imageLink")&&f.tagName.toLowerCase()==="a"){return true}else{var d=AC.Retina.Image.removeCSSURLSyntax(AC.Element.getStyle(f,"background-image"));return(((d.match(AC.Retina.rasterImageFormatRegex())!==null)&&e))}}},__replaceableElementsWithinElement:function ac___replaceableElementsWithinElement(h){h=AC.Element.getElementById(h);var g=this;var j=h.getElementsByTagName("*");var f=[];var i;for(i=0;i<j.length;i++){if(this.__isReplaceable(j[i])){f.push(j[i])}}return f},__prioritize:function ac___prioritize(f){var h=[];var g=function(a){if(typeof a.responsiveImageObject!=="undefined"){return}var b=new AC.Retina.Image(a,this.options);if(b.hiResSrc()!==null&&!b.isHiRes()){if(typeof h[b.priority()]==="undefined"){h[b.priority()]=[]}h[b.priority()].push(b);a.responsiveImageObject=b}else{if(b.hiResSrc()&&b.isHiRes()){b.setStatus("already-hires")}else{b.setStatus("not-replaceable")}}}.bind(this);f.forEach(g);var e;for(e=this.options.lowestPriority;e>=0;e--){if(typeof h[e]==="undefined"){h[e]=[]}}return AC.Array.flatten(h)},__replaceQueues:function ac___replaceQueues(){if(typeof this.__queues==="undefined"){this.__queues=[]}if(this.__queues.length>0&&this.__queues[0].length>0){this.__queues.push([]);var b=this.__replaceQueues.bind(this);this.__replaceNextQueue(b)}},__replaceNextQueue:function ac___replaceNextQueue(h){var f=this;var g=f.__queues[0].reverse();var j=function(){if(f.options.debug===true){AC.log(arguments)}};f.__queues.splice(0,1);var i=function(){j("Found "+g.length+" elements to replace.");var b=function(){var c=g.pop();f._replacedElements.push(c);if(!c){j("No more images to start replacing.");if(typeof h==="function"){h()}h=AC.Function.emptyFunction;return}c.replace(function(d){j("Replaced image.",c.hiResSrc(),"status: "+c.status());b()})};for(var a=0;a<f.options.queueSize;a++){b()}};window.setTimeout(i,10)},replace:function ac_replace(f,e){var d=this.__addToQueue.bind(this);this.__prioritize(this.__potentialElements(f,e)).forEach(d);this.__replaceQueues()}};AC.Retina.iOSHandheld=function(){return(!!navigator.userAgent.match(/AppleWebKit/i)&&(!!navigator.userAgent.match(/Mobile/i)&&!navigator.userAgent.match(/ipad/i)))};AC.Retina._rasterImageFormatRegex=/(\.jpg($|#.*|\?.*)|\.png($|#.*|\?.*)|\.gif($|#.*|\?.*))/;AC.Retina.rasterImageFormatRegex=function(){return AC.Retina._rasterImageFormatRegex};AC.Retina.devicePixelRatio=function(){if(typeof AC.Retina._devicePixelRatio!=="undefined"){return AC.Retina._devicePixelRatio}if("devicePixelRatio" in window&&window.devicePixelRatio>1){return AC.Retina._devicePixelRatio=2}else{return AC.Retina._devicePixelRatio=1}};AC.Retina.__nearestAncestorHasAttribute=function(j,g,h){var i=AC.Retina.__ancestors(j);var f;for(f=0;f<i.length;f++){if(i[f].hasAttribute(g)){if(typeof h==="undefined"||i[f].getAttribute(g)===h){return i[f]}else{return null}}}return null};AC.Retina.__ancestors=function(d){d=AC.Element.getElementById(d);var c=[];if(AC.Element.isElement(d.parentNode)){while(d=d.parentNode){if(AC.Element.isElement(d)){c.push(d)}}}return c};AC.Retina.sharedInstance();AC.Retina.Image=AC.Class();AC.Retina.Image.prototype={initialize:function ac_initialize(c,d){this._el=c;this._tagName=this._el.tagName.toLowerCase();this.options=AC.Object.extend(AC.Object.clone(d),AC.Retina.Image.convertParametersToOptions(this.src()));this.setStatus("considered");AC.Object.synthesize(this)},setStatus:function ac_setStatus(b){if(typeof b==="string"){this._status=b;this._el.setAttribute(this.options.replacedAttribute,b)}},status:function ac_status(){return this._el.getAttribute(this.options.replacedAttribute)},src:function ac_src(){if(typeof this._src!=="undefined"){return this._src}if(this.isImageLink()){this._src=this._el.getAttribute("href")}else{if(this._tagName==="img"){this._src=this._el.getAttribute("src")}else{this._src=AC.Retina.Image.removeCSSURLSyntax(AC.Element.getStyle(this._el,"background-image"));if(this._src==="none"){return this._src=""}}}return this._src},isImageLink:function ac_isImageLink(){if(typeof this._isImageLink!=="undefined"){return this._isImageLink}return this._isImageLink=(AC.Element.hasClassName(this._el,"imageLink")&&this._tagName==="a")},hiResSrc:function ac_hiResSrc(){if(typeof this._hiResSrc!=="undefined"){return this._hiResSrc}var b;if(typeof this.options.hiresFormat==="string"){b=this.src().match(/^(.*)((\.[a-z]{3})($|#.*|\?.*))/i);if(b!==null&&b.length>1){return this._hiResSrc=b[1]+"."+this.options.hiresFormat+(b[4]||"")}}b=this.src().match(this.options.filenameRegex);if(b===null){return this._hiResSrc=null}else{return this._hiResSrc=b[1]+this.options.filenameInsert.replace("☃",AC.Retina.devicePixelRatio())+b[2]}},isHiRes:function ac_isHiRes(){if(this._isHiRes===true){return this._isHiRes}if(this.status()==="replaced"){return this._isHiRes=true}var b=this.src();if(b.match(AC.Retina.rasterImageFormatRegex())===null){return this._isHiRes=true}if(b.match(this.options.ignoreCheck)!==null){return this._isHiRes=true}return this._isHiRes=false},priority:function ac_priority(){if(typeof this._priority!=="undefined"){return this._priority}if(this.options.recursive&&this._el.hasAttribute(this.options.attribute)===false){var b=AC.Retina.__nearestAncestorHasAttribute(this._el,this.options.attribute);if(!!b){this._priority=parseInt(b.getAttribute(this.options.attribute))}else{this._priority=this.options.lowestPriority}}else{this._priority=parseInt(this._el.getAttribute(this.options.attribute))}if(isNaN(this._priority)||this._priority>this.options.lowestPriority){this._priority=this.options.lowestPriority}else{if(this._priority<0){this._priority=0}}return this._priority},replace:function ac_replace(h){var j=this;var f=j.replace.bind(j,h);var g=j.hiResSrc();var i;if(j._exists===false){j.setStatus("404");if(typeof h==="function"){h(false)}return}if(j.options.checkExists===true&&typeof j._exists==="undefined"){if(j.options.checkAsRootRelative===true||(g.indexOf(window.location.origin)===0||g.indexOf("/")===0)){i=(j.options.checkAsRootRelative===true)?g.replace(/^https?:\/\/[^\/]*\//,"/"):g;j._exists=false;return AC.Ajax.checkURL(i,function(a){j._exists=a;f()})}}if(j.isImageLink()){j._el.setAttribute("href",g);j.setStatus("replaced");if(typeof h==="function"){h(true)}}else{if((j.options.preload===true||j._tagName!=="img")&&j._isPreloaded!==true){return j.preload(f)}if(j._tagName==="img"){j._el.setAttribute("src",g);if((j.options.preload!==true)){j.setStatus("loading");AC.Element.addEventListener(j._el,"load",function(a){j.setStatus("replaced");if(typeof h==="function"){h(true)}});AC.Element.addEventListener(j._el,"error",function(a){j.setStatus("404");j._el.setAttribute("src",j.src());if(typeof h==="function"){h(false)}})}}else{j._el.setStyle("background-image:url("+g+");");j._el.setStyle("background-size:"+(j.width/AC.Retina.devicePixelRatio())+"px "+(j.height/AC.Retina.devicePixelRatio())+"px;");if(typeof h==="function"){h(true)}}}j.synthesize()},preload:function ac_preload(c){if(this._isPreloaded){return true}this.setStatus("loading");var d=new Element("img");AC.Element.addEventListener(d,"load",function(){this._isPreloaded=true;this.width=d.width;this.height=d.height;this.setStatus("replaced");if(typeof c==="function"){c()}}.bind(this));AC.Element.addEventListener(d,"error",function(){this.setStatus("404");this._exists=false;if(typeof c==="function"){c()}}.bind(this));d.src=this.hiResSrc()}};AC.Retina.Image.removeCSSURLSyntax=function(b){if(typeof b==="string"&&typeof b.replace==="function"){return b.replace(/^url\(/,"").replace(/\)$/,"")}return""};AC.Retina.Image.convertParametersToOptions=function(d){if(typeof d==="string"&&typeof d.toQueryParams==="function"){var e=d.toQueryParams(),f;for(f in e){if(e.hasOwnProperty(f)){e[f.camelize()]=e[f]}}return e}return{}};
